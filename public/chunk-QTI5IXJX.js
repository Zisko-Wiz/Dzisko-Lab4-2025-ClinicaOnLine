import{a as xe}from"./chunk-4HDWFXB7.js";import"./chunk-FK6H3RFT.js";import{b as le,c as N}from"./chunk-V5D6QXZY.js";import{c as ue}from"./chunk-XH2GW3PU.js";import{a as Pe,b as _e}from"./chunk-JEX352U2.js";import{a as we}from"./chunk-DGLVMMBZ.js";import"./chunk-UX76GUPX.js";import{b as ge,f as be,k as ve,o as ye}from"./chunk-7XGRIRYV.js";import{a as pe}from"./chunk-3FX5JOZC.js";import"./chunk-X5YLR3NI.js";import{j as Ce,k as Y}from"./chunk-K6BGC66R.js";import"./chunk-TMRG5LEW.js";import"./chunk-5M3LTLOJ.js";import"./chunk-SLRTFQNB.js";import{Da as F,Hb as O,Lb as ie,Mb as ae,Nb as oe,Oa as G,X as he,aa as z,ba as W,bb as X,cb as q,cc as se,hb as H,ib as P,jb as _,kb as $,ob as re,pa as me,sb as U,tb as V,xb as J,yb as Z,zb as K}from"./chunk-VLVEKFRY.js";import{e as Ne,g as je,i as fe}from"./chunk-ODN5LVDJ.js";var Se=Ne((Te,ce)=>{"use strict";(function(y){"use strict";var e=Ue(),t=Ve(),c=Re(),n=$e(),r={imagePlaceholder:void 0,cacheBust:!1},m={toSvg:R,toPng:ke,toJpeg:Ae,toBlob:Ie,toPixelData:Me,impl:{fontFaces:c,images:n,util:e,inliner:t,options:{}}};typeof ce<"u"?ce.exports=m:y.domtoimage=m;function R(o,a){return a=a||{},Oe(a),Promise.resolve(o).then(function(u){return de(u,a.filter,!0)}).then(Be).then(Fe).then(s).then(function(u){return Le(u,a.width||e.width(o),a.height||e.height(o))});function s(u){return a.bgcolor&&(u.style.backgroundColor=a.bgcolor),a.width&&(u.style.width=a.width+"px"),a.height&&(u.style.height=a.height+"px"),a.style&&Object.keys(a.style).forEach(function(p){u.style[p]=a.style[p]}),u}}function Me(o,a){return Q(o,a||{}).then(function(s){return s.getContext("2d").getImageData(0,0,e.width(o),e.height(o)).data})}function ke(o,a){return Q(o,a||{}).then(function(s){return s.toDataURL()})}function Ae(o,a){return a=a||{},Q(o,a).then(function(s){return s.toDataURL("image/jpeg",a.quality||1)})}function Ie(o,a){return Q(o,a||{}).then(e.canvasToBlob)}function Oe(o){typeof o.imagePlaceholder>"u"?m.impl.options.imagePlaceholder=r.imagePlaceholder:m.impl.options.imagePlaceholder=o.imagePlaceholder,typeof o.cacheBust>"u"?m.impl.options.cacheBust=r.cacheBust:m.impl.options.cacheBust=o.cacheBust}function Q(o,a){return R(o,a).then(e.makeImage).then(e.delay(100)).then(function(u){var p=s(o);return p.getContext("2d").drawImage(u,0,0),p});function s(u){var p=document.createElement("canvas");if(p.width=a.width||e.width(u),p.height=a.height||e.height(u),a.bgcolor){var h=p.getContext("2d");h.fillStyle=a.bgcolor,h.fillRect(0,0,p.width,p.height)}return p}}function de(o,a,s){if(!s&&a&&!a(o))return Promise.resolve();return Promise.resolve(o).then(u).then(function(l){return p(o,l,a)}).then(function(l){return h(o,l)});function u(l){return l instanceof HTMLCanvasElement?e.makeImage(l.toDataURL()):l.cloneNode(!1)}function p(l,d,x){var D=l.childNodes;if(D.length===0)return Promise.resolve(d);return v(d,e.asArray(D),x).then(function(){return d});function v(L,T,w){var S=Promise.resolve();return T.forEach(function(B){S=S.then(function(){return de(B,w)}).then(function(E){E&&L.appendChild(E)})}),S}}function h(l,d){if(!(d instanceof Element))return d;return Promise.resolve().then(x).then(D).then(v).then(L).then(function(){return d});function x(){T(window.getComputedStyle(l),d.style);function T(w,S){w.cssText?S.cssText=w.cssText:B(w,S);function B(E,k){e.asArray(E).forEach(function(i){k.setProperty(i,E.getPropertyValue(i),E.getPropertyPriority(i))})}}}function D(){[":before",":after"].forEach(function(w){T(w)});function T(w){var S=window.getComputedStyle(l,w),B=S.getPropertyValue("content");if(B===""||B==="none")return;var E=e.uid();d.className=d.className+" "+E;var k=document.createElement("style");k.appendChild(i(E,w,S)),d.appendChild(k);function i(f,b,g){var C="."+f+":"+b,M=g.cssText?te(g):ne(g);return document.createTextNode(C+"{"+M+"}");function te(A){var I=A.getPropertyValue("content");return A.cssText+" content: "+I+";"}function ne(A){return e.asArray(A).map(I).join("; ")+";";function I(j){return j+": "+A.getPropertyValue(j)+(A.getPropertyPriority(j)?" !important":"")}}}}}function v(){l instanceof HTMLTextAreaElement&&(d.innerHTML=l.value),l instanceof HTMLInputElement&&d.setAttribute("value",l.value)}function L(){d instanceof SVGElement&&(d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d instanceof SVGRectElement&&["width","height"].forEach(function(T){var w=d.getAttribute(T);w&&d.style.setProperty(T,w)}))}}}function Be(o){return c.resolveAll().then(function(a){var s=document.createElement("style");return o.appendChild(s),s.appendChild(document.createTextNode(a)),o})}function Fe(o){return n.inlineAll(o).then(function(){return o})}function Le(o,a,s){return Promise.resolve(o).then(function(u){return u.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(u)}).then(e.escapeXhtml).then(function(u){return'<foreignObject x="0" y="0" width="100%" height="100%">'+u+"</foreignObject>"}).then(function(u){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+s+'">'+u+"</svg>"}).then(function(u){return"data:image/svg+xml;charset=utf-8,"+u})}function Ue(){return{escape:L,parseExtension:a,mimeType:s,dataAsUrl:v,isDataUrl:u,canvasToBlob:h,resolveUrl:l,getAndEncode:D,uid:d(),delay:T,asArray:w,escapeXhtml:S,makeImage:x,width:B,height:E};function o(){var i="application/font-woff",f="image/jpeg";return{woff:i,woff2:i,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:f,jpeg:f,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function a(i){var f=/\.([^\.\/]*?)$/g.exec(i);return f?f[1]:""}function s(i){var f=a(i).toLowerCase();return o()[f]||""}function u(i){return i.search(/^(data:)/)!==-1}function p(i){return new Promise(function(f){for(var b=window.atob(i.toDataURL().split(",")[1]),g=b.length,C=new Uint8Array(g),M=0;M<g;M++)C[M]=b.charCodeAt(M);f(new Blob([C],{type:"image/png"}))})}function h(i){return i.toBlob?new Promise(function(f){i.toBlob(f)}):p(i)}function l(i,f){var b=document.implementation.createHTMLDocument(),g=b.createElement("base");b.head.appendChild(g);var C=b.createElement("a");return b.body.appendChild(C),g.href=f,C.href=i,C.href}function d(){var i=0;return function(){return"u"+f()+i++;function f(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function x(i){return new Promise(function(f,b){var g=new Image;g.onload=function(){f(g)},g.onerror=b,g.src=i})}function D(i){var f=3e4;return m.impl.options.cacheBust&&(i+=(/\?/.test(i)?"&":"?")+new Date().getTime()),new Promise(function(b){var g=new XMLHttpRequest;g.onreadystatechange=te,g.ontimeout=ne,g.responseType="blob",g.timeout=f,g.open("GET",i,!0),g.send();var C;if(m.impl.options.imagePlaceholder){var M=m.impl.options.imagePlaceholder.split(/,/);M&&M[1]&&(C=M[1])}function te(){if(g.readyState===4){if(g.status!==200){C?b(C):A("cannot fetch resource: "+i+", status: "+g.status);return}var I=new FileReader;I.onloadend=function(){var j=I.result.split(/,/)[1];b(j)},I.readAsDataURL(g.response)}}function ne(){C?b(C):A("timeout of "+f+"ms occured while fetching resource: "+i)}function A(I){console.error(I),b("")}})}function v(i,f){return"data:"+f+";base64,"+i}function L(i){return i.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function T(i){return function(f){return new Promise(function(b){setTimeout(function(){b(f)},i)})}}function w(i){for(var f=[],b=i.length,g=0;g<b;g++)f.push(i[g]);return f}function S(i){return i.replace(/#/g,"%23").replace(/\n/g,"%0A")}function B(i){var f=k(i,"border-left-width"),b=k(i,"border-right-width");return i.scrollWidth+f+b}function E(i){var f=k(i,"border-top-width"),b=k(i,"border-bottom-width");return i.scrollHeight+f+b}function k(i,f){var b=window.getComputedStyle(i).getPropertyValue(f);return parseFloat(b.replace("px",""))}}function Ve(){var o=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:p,shouldProcess:a,impl:{readUrls:s,inline:u}};function a(h){return h.search(o)!==-1}function s(h){for(var l=[],d;(d=o.exec(h))!==null;)l.push(d[1]);return l.filter(function(x){return!e.isDataUrl(x)})}function u(h,l,d,x){return Promise.resolve(l).then(function(v){return d?e.resolveUrl(v,d):v}).then(x||e.getAndEncode).then(function(v){return e.dataAsUrl(v,e.mimeType(l))}).then(function(v){return h.replace(D(l),"$1"+v+"$3")});function D(v){return new RegExp(`(url\\(['"]?)(`+e.escape(v)+`)(['"]?\\))`,"g")}}function p(h,l,d){if(x())return Promise.resolve(h);return Promise.resolve(h).then(s).then(function(D){var v=Promise.resolve(h);return D.forEach(function(L){v=v.then(function(T){return u(T,L,l,d)})}),v});function x(){return!a(h)}}}function Re(){return{resolveAll:o,impl:{readAll:a}};function o(){return a(document).then(function(s){return Promise.all(s.map(function(u){return u.resolve()}))}).then(function(s){return s.join(`
`)})}function a(){return Promise.resolve(e.asArray(document.styleSheets)).then(u).then(s).then(function(h){return h.map(p)});function s(h){return h.filter(function(l){return l.type===CSSRule.FONT_FACE_RULE}).filter(function(l){return t.shouldProcess(l.style.getPropertyValue("src"))})}function u(h){var l=[];return h.forEach(function(d){try{e.asArray(d.cssRules||[]).forEach(l.push.bind(l))}catch(x){console.log("Error while reading CSS rules from "+d.href,x.toString())}}),l}function p(h){return{resolve:function(){var d=(h.parentStyleSheet||{}).href;return t.inlineAll(h.cssText,d)},src:function(){return h.style.getPropertyValue("src")}}}}}function $e(){return{inlineAll:a,impl:{newImage:o}};function o(s){return{inline:u};function u(p){return e.isDataUrl(s.src)?Promise.resolve():Promise.resolve(s.src).then(p||e.getAndEncode).then(function(h){return e.dataAsUrl(h,e.mimeType(s.src))}).then(function(h){return new Promise(function(l,d){s.onload=l,s.onerror=d,s.src=h})})}}function a(s){if(!(s instanceof Element))return Promise.resolve(s);return u(s).then(function(){return s instanceof HTMLImageElement?o(s).inline():Promise.all(e.asArray(s.childNodes).map(function(p){return a(p)}))});function u(p){var h=p.style.getPropertyValue("background");return h?t.inlineAll(h).then(function(l){p.style.setProperty("background",l,p.style.getPropertyPriority("background"))}).then(function(){return p}):Promise.resolve(p)}}}})(Te)});var ee=class y{chart;barChartType="bar";labels=[];newLabels=se([]);data=[];newData=se([]);barChartData={labels:this.labels,datasets:[{data:this.data,label:"Turnos"}]};ngOnChanges(e){this.labels.length=0,this.data.length=0,this.labels.push(...this.newLabels()),this.data.push(...this.newData()),this.chart?.update()}static \u0275fac=function(t){return new(t||y)};static \u0275cmp=G({type:y,selectors:[["app-chart-bar2"]],viewQuery:function(t,c){if(t&1&&J(ue,5),t&2){let n;Z(n=K())&&(c.chart=n.first)}},inputs:{newLabels:[1,"newLabels"],newData:[1,"newData"]},features:[me],decls:1,vars:2,consts:[["baseChart","",1,"chart",3,"data","type"]],template:function(t,c){t&1&&$(0,"canvas",0),t&2&&H("data",c.barChartData)("type",c.barChartType)},dependencies:[Y,ue],styles:[".chart[_ngcontent-%COMP%]{width:40vw}"]})};var De=je(Se());var He=["dataToExport"];function Qe(y,e){y&1&&(P(0,"div",2),$(1,"mat-spinner",6),_())}function Ge(y,e){if(y&1){let t=re();P(0,"div",5)(1,"div",7)(2,"label"),O(3,"Fecha inicial:"),_(),P(4,"input",8),oe("ngModelChange",function(n){z(t);let r=V();return ae(r.fechaInicial,n)||(r.fechaInicial=n),W(n)}),_()(),P(5,"div",9)(6,"label"),O(7,"Fecha final:"),_(),P(8,"input",8),oe("ngModelChange",function(n){z(t);let r=V();return ae(r.fechaFinal,n)||(r.fechaFinal=n),W(n)}),_()(),P(9,"div",10)(10,"button",11),U("click",function(){z(t);let n=V();return W(n.setDatasetSegunModo())}),O(11,"Generar"),_()()()}if(y&2){let t=V();F(4),ie("ngModel",t.fechaInicial),F(4),ie("ngModel",t.fechaFinal),F(2),H("disabled",t.fechaInicial==""||t.fechaFinal=="")}}function Xe(y,e){if(y&1){let t=re();P(0,"div",12,0),$(2,"app-chart-bar2",13),_(),P(3,"div")(4,"button",4),U("click",function(){z(t);let n=V();return W(n.downloadAsPdf())}),O(5,"Descargar PDF"),_()()}if(y&2){let t=V();F(2),H("newLabels",t.labels)("newData",t.data)}}var Ee=class y{supaService=he(pe);titulo="";loading=!1;showChart=!1;showDatePicker=!1;turnos=[];fechaInicial="";fechaFinal="";modo="";labels=[];data=[];dataToExport;ngOnInit(){this.getTurnos().then(()=>{this.loading=!1})}getTurnos(){return fe(this,null,function*(){return this.supaService.supabase.from("turnos").select(`
      *,
      users(firstname, surname)
      `).order("fecha",{ascending:!0}).then(({data:e,error:t})=>{t?console.error(t.message,t.code):this.turnos=e})})}ocultarChart(e){this.modo=e,this.showChart=!1,this.showDatePicker=!0}setDatasetSegunModo(){switch(this.modo){case"solicitados":this.titulo="Turnos solicitados por Especialista",this.setDatasetTurnosPorEspecialista();break;case"finalizados":this.titulo="Turnos finalizados por especialista",this.setDatasetTurnosFinalizadosPorEspecialista();break}}setDatasetTurnosPorEspecialidad(){this.loading=!0,this.showDatePicker=!1,this.titulo="Turnos por especialidad";var e=[],t=[],c=[];for(let n=0;n<this.turnos.length;n++)e.find(r=>r.label==this.turnos[n].especialidad)==null?e.push({label:this.turnos[n].especialidad,data:1}):e[e.findIndex(r=>r.label==this.turnos[n].especialidad)].data+=1;for(let n=0;n<e.length;n++)t.push(e[n].label),c.push(e[n].data);this.labels=t,this.data=c,this.showChart=!0,this.loading=!1}setDatasetTurnosPorDia(){this.loading=!0,this.showDatePicker=!1,this.titulo="Turnos por d\xEDa";var e=[],t=[],c=[];for(let n=0;n<this.turnos.length;n++){let r=N.fromISO(this.turnos[n].fecha),m=r.setZone("America/Argentina/Buenos_Aires").toFormat("cccc");e.find(R=>R.label==m)==null?e.push({label:m,data:1,day:r.weekday}):e[e.findIndex(R=>R.label==m)].data+=1}e.sort((n,r)=>n.day-r.day);for(let n=0;n<e.length;n++){switch(e[n].label){case"Monday":e[n].label="Lunes";break;case"Tuesday":e[n].label="Martes";break;case"Wednesday":e[n].label="Mi\xE9rcoles";break;case"Thursday":e[n].label="Jueves";break;case"Friday":e[n].label="Viernes";break;case"Saturday":e[n].label="S\xE1bado";break;case"Sunday":e[n].label="Domingo";break}t.push(e[n].label),c.push(e[n].data)}this.labels=t,this.data=c,this.showChart=!0,this.loading=!1}setDatasetTurnosPorEspecialista(){this.loading=!0;var e=le.fromISO(`${this.fechaInicial}/${this.fechaFinal}`),t=[],c=[],n=[];for(let r=0;r<this.turnos.length;r++)e.contains(N.fromISO(this.turnos[r].fecha))&&t.find(m=>m.label==`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`)==null?t.push({label:`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`,data:1}):e.contains(N.fromISO(this.turnos[r].fecha))&&t.find(m=>m.label==`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`)!=null&&(t[t.findIndex(m=>m.label==`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`)].data+=1);for(let r=0;r<t.length;r++)c.push(t[r].label),n.push(t[r].data);this.labels=c,this.data=n,this.showChart=!0,this.loading=!1}setDatasetTurnosFinalizadosPorEspecialista(){this.loading=!0;var e=le.fromISO(`${this.fechaInicial}/${this.fechaFinal}`),t=[],c=[],n=[];for(let r=0;r<this.turnos.length;r++)e.contains(N.fromISO(this.turnos[r].fecha))&&t.find(m=>m.label==`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`)==null&&this.turnos[r].estado=="finalizado"?t.push({label:`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`,data:1}):e.contains(N.fromISO(this.turnos[r].fecha))&&this.turnos[r].estado=="finalizado"&&t.find(m=>m.label==`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`)!=null&&(t[t.findIndex(m=>m.label==`${this.turnos[r].users.firstname} ${this.turnos[r].users.surname}`)].data+=1);for(let r=0;r<t.length;r++)c.push(t[r].label),n.push(t[r].data);this.labels=c,this.data=n,this.showChart=!0,this.loading=!1}downloadAsPdf(){var e=this.dataToExport.nativeElement.clientWidth,t=this.dataToExport.nativeElement.clientHeight+40;let c="l",n="pt";e>t?c="l":c="p",De.default.toPng(this.dataToExport.nativeElement,{width:e,height:t}).then(r=>{var m=new xe({orientation:"landscape",unit:"pt",format:[e+30,t+200]});m.setFontSize(48),m.setTextColor("#2585fe"),m.text(this.titulo,25,75),m.setFontSize(24),m.setTextColor("#131523"),m.addImage(r,"PNG",25,185,e,t),m.save(this.titulo+".pdf")})}static \u0275fac=function(t){return new(t||y)};static \u0275cmp=G({type:y,selectors:[["app-stats"]],viewQuery:function(t,c){if(t&1&&J(He,5),t&2){let n;Z(n=K())&&(c.dataToExport=n.first)}},decls:14,vars:3,consts:[["dataToExport",""],[1,"animate__animated","animate__bounceInDown"],[1,"spinner"],[1,"botones"],["mat-flat-button","",3,"click"],[1,"datepickers-container"],["mode","indeterminate"],["id","dp1"],["type","date",1,"datepicker",3,"ngModelChange","ngModel"],["id","dp2"],["id","gbtn"],["mat-flat-button","",3,"click","disabled"],[1,"grafico"],[3,"newLabels","newData"]],template:function(t,c){t&1&&($(0,"app-header"),P(1,"div",1),X(2,Qe,2,0,"div",2),P(3,"div",3)(4,"button",4),U("click",function(){return c.setDatasetTurnosPorEspecialidad()}),O(5,"Turnos por especialidad"),_(),P(6,"button",4),U("click",function(){return c.setDatasetTurnosPorDia()}),O(7,"Turnos por d\xEDa"),_(),P(8,"button",4),U("click",function(){return c.ocultarChart("solicitados")}),O(9,"Turnos solicitados"),_(),P(10,"button",4),U("click",function(){return c.ocultarChart("finalizados")}),O(11,"Turnos finalizados"),_()(),X(12,Ge,12,3,"div",5),X(13,Xe,6,2),_()),t&2&&(F(2),q(c.loading?2:-1),F(10),q(c.showDatePicker?12:-1),F(),q(c.showChart?13:-1))},dependencies:[we,ee,Y,Ce,_e,Pe,ye,ge,be,ve],styles:[".animate__animated[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding-top:5vh;width:100%;height:100%}.grafico[_ngcontent-%COMP%]{margin-top:2vh;display:flex;align-items:center;justify-content:center;width:50vw;background-color:#fff}.spinner[_ngcontent-%COMP%]{background-color:#fff}.datepickers-container[_ngcontent-%COMP%]{display:grid;grid-template:1fr 1fr/1fr 1fr;align-items:center;justify-content:center;justify-items:center;background-color:#2da2ac;border:2px solid #19305a;width:20vw;margin-top:2vh;padding-top:1vh}#dp1[_ngcontent-%COMP%]{grid-area:1/1/2/2}#dp2[_ngcontent-%COMP%]{grid-area:1/2/2/3}#dp1[_ngcontent-%COMP%], #dp2[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}#gbtn[_ngcontent-%COMP%]{grid-area:2/1/3/3}.dp-c[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:space-evenly}.datepicker[_ngcontent-%COMP%]{height:3vh}"]})};export{Ee as Stats};
