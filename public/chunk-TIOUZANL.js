import{a as _e}from"./chunk-VTNR6SYS.js";import{a as fe}from"./chunk-D3R3HLRR.js";import{a as j,b as G}from"./chunk-MUUKOUL7.js";import{a as b,b as Z,c as ee,d as te,e as ie,f as ne,g as oe,h as ae,i as re,j as le,k as se,l as me,m as y,n as de,o as E,p as ce,q as ue}from"./chunk-MHQ2INVZ.js";import{a as pe}from"./chunk-5M4QBNDW.js";import"./chunk-TLV7MEOK.js";import"./chunk-NVNTWJJS.js";import{a as X,b as Y}from"./chunk-JEX352U2.js";import{a as z}from"./chunk-DGLVMMBZ.js";import"./chunk-UX76GUPX.js";import{d as W}from"./chunk-SENEU3FL.js";import{b as Q,f as N,k as q,o as L}from"./chunk-7XGRIRYV.js";import{a as F}from"./chunk-3FX5JOZC.js";import"./chunk-X5YLR3NI.js";import{j as J,k as K}from"./chunk-K6BGC66R.js";import"./chunk-TMRG5LEW.js";import"./chunk-5M3LTLOJ.js";import{h as B}from"./chunk-SLRTFQNB.js";import{Da as s,Eb as P,Hb as l,Ib as f,Jb as O,Lb as k,Mb as U,Nb as A,Oa as $,Sb as V,Ta as m,Ub as R,X as H,aa as h,ba as T,bb as C,cb as w,hb as S,ib as o,jb as a,kb as _,lb as c,mb as u,ob as g,sb as I,tb as p,xb as x,yb as M,zb as v}from"./chunk-VLVEKFRY.js";import"./chunk-ODN5LVDJ.js";function we(e,t){e&1&&(o(0,"div",3),_(1,"mat-spinner",26),a())}function Se(e,t){e&1&&(o(0,"th",27),l(1,"Fecha"),a())}function ge(e,t){if(e&1&&(o(0,"td",28),l(1),V(2,"date"),a()),e&2){let i=t.$implicit;s(),f(R(2,1,i.fecha,"dd/MM/yyyy HH:mm"))}}function xe(e,t){e&1&&(o(0,"th",27),l(1,"Especialista"),a())}function Me(e,t){if(e&1&&(o(0,"td",28),l(1),a()),e&2){let i=t.$implicit;s(),f(i.email_esp)}}function ve(e,t){e&1&&(o(0,"th",27),l(1,"Nombre"),a())}function be(e,t){if(e&1&&(o(0,"td",28),l(1),a()),e&2){let i=t.$implicit;s(),f(i.firstname)}}function ye(e,t){e&1&&(o(0,"th",27),l(1,"Apellido"),a())}function Ee(e,t){if(e&1&&(o(0,"td",28),l(1),a()),e&2){let i=t.$implicit;s(),f(i.surname)}}function De(e,t){e&1&&(o(0,"th",27),l(1,"Especialidad"),a())}function Ie(e,t){if(e&1&&(o(0,"td",28),l(1),a()),e&2){let i=t.$implicit;s(),f(i.especialidad)}}function Pe(e,t){e&1&&(o(0,"th",27),l(1,"Paciente"),a())}function Ve(e,t){if(e&1&&(o(0,"td",28),l(1),V(2,"nombre"),a()),e&2){let i=t.$implicit,r=p();s(),f(R(2,1,i.email_paciente,r.todosUsuarios))}}function Re(e,t){e&1&&(o(0,"th",27),l(1,"Estado"),a())}function He(e,t){if(e&1&&(o(0,"td",29),l(1),a()),e&2){let i=t.$implicit;s(),f(i.estado.toUpperCase())}}function $e(e,t){e&1&&(o(0,"th",30),l(1,"Acci\xF3n"),a())}function Oe(e,t){if(e&1){let i=g();o(0,"button",32),I("click",function(n){h(i);let d=p(),D=d.$implicit,Te=d.index,Ce=p();return T(Ce.onActionButtonClick(n,D,Te))})("focusout",function(){h(i);let n=p(2);return T(n.refresh())}),l(1,"Cancelar"),a()}if(e&2){let i=p().$implicit;P("pointer-events",i.comentario==null||i.comentario==""?"none":"auto")}}function ke(e,t){if(e&1&&(o(0,"td",28),C(1,Oe,2,2,"button",31),a()),e&2){let i=t.$implicit;s(),w(i.estado=="pendiente"?1:-1)}}function Ue(e,t){e&1&&(o(0,"th",30),l(1,"Motivo"),a())}function Ae(e,t){if(e&1){let i=g();o(0,"textarea",34),A("ngModelChange",function(n){h(i);let d=p().$implicit;return U(d.comentario,n)||(d.comentario=n),T(n)}),a()}if(e&2){let i=p().$implicit;k("ngModel",i.comentario)}}function Be(e,t){if(e&1&&l(0),e&2){let i=p().$implicit;O(" ",i.comentario," ")}}function Fe(e,t){if(e&1&&(o(0,"td",28),C(1,Ae,1,1,"textarea",33)(2,Be,1,1),a()),e&2){let i=t.$implicit;s(),w(i.estado=="pendiente"?1:i.estado=="cancelado"?2:-1)}}function Qe(e,t){e&1&&_(0,"tr",35)}function Ne(e,t){e&1&&_(0,"tr",36)}var he=class e{paginator;sort;table;supabaseService=H(F);showSpinner=!1;todosUsuarios=[];dataSource;displayedColumns=["fecha","email_esp","firstname","surname","especialidad","email_paciente","estado","action","comment"];ngOnInit(){this.getTurnos(),this.getUsuarios()}getTurnos(){this.supabaseService.supabase.from("turnos").select(`
      *,
      users(firstname, surname)
      `).then(({data:t,error:i})=>{if(i)console.log(i.message);else{var r=[];for(let n=0;n<t.length;n++){let d=new fe(t[n].fecha,t[n].email_esp,t[n].email_paciente,t[n].especialidad,t[n].estado,t[n].comentario,t[n].users.firstname,t[n].users.surname,t[n].calificacion);r.push(d)}this.dataSource=new me(r),this.refresh()}})}getUsuarios(){this.supabaseService.supabase.from("users").select().then(({data:t,error:i})=>{i?console.log(i.message):(this.todosUsuarios=t,this.refresh())})}onActionButtonClick(t,i,r){this.showSpinner=!0;let n=this.dataSource.data.find(d=>d.fecha==i.fecha);n.estado="cancelado",this.cancelTurno(n.fecha,n.estado,n.comentario),this.table.renderRows()}cancelTurno(t,i,r){this.supabaseService.supabase.from("turnos").update({estado:i,comentario:r}).eq("fecha",t).then(()=>{this.showSpinner=!1})}ngAfterViewInit(){this.dataSource!=null&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.table.dataSource=this.dataSource)}refresh(){this.dataSource!=null&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.table.dataSource=this.dataSource)}applyFilter(t){let i=t.target.value;this.dataSource.filter=i.trim().toLowerCase()}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=$({type:e,selectors:[["app-todos-turnos"]],viewQuery:function(i,r){if(i&1&&(x(y,5),x(E,5),x(b,5)),i&2){let n;M(n=v())&&(r.paginator=n.first),M(n=v())&&(r.sort=n.first),M(n=v())&&(r.table=n.first)}},decls:41,vars:8,consts:[["input",""],["paginator",""],["hover","",1,"animate__animated","animate__rotateInDownLeft"],[1,"spinner"],[1,"options"],[1,"example-full-width"],["matInput","","placeholder","Buscar",1,"cutom-input",3,"keyup"],[1,"users-table"],[1,"mat-elevation-z2"],["mat-table","","matSort","","aria-label","Users",1,"full-width-table"],["matColumnDef","fecha"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email_esp"],["matColumnDef","firstname"],["matColumnDef","surname"],["matColumnDef","especialidad"],["matColumnDef","email_paciente"],["matColumnDef","estado"],["mat-cell","","appRemarcar","",4,"matCellDef"],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","comment"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page",3,"length","pageIndex","pageSize"],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","","appRemarcar",""],["mat-header-cell",""],["mat-raised-button","",3,"pointer-events"],["mat-raised-button","",3,"click","focusout"],[3,"ngModel"],[3,"ngModelChange","ngModel"],["mat-header-row",""],["mat-row",""]],template:function(i,r){if(i&1){let n=g();_(0,"app-header"),o(1,"div",2),C(2,we,2,0,"div",3),o(3,"div",4)(4,"mat-form-field",5)(5,"input",6,0),I("keyup",function(D){return h(n),T(r.applyFilter(D))}),a()()(),o(7,"div",7)(8,"div",8)(9,"table",9),c(10,10),m(11,Se,2,0,"th",11)(12,ge,3,4,"td",12),u(),c(13,13),m(14,xe,2,0,"th",11)(15,Me,2,1,"td",12),u(),c(16,14),m(17,ve,2,0,"th",11)(18,be,2,1,"td",12),u(),c(19,15),m(20,ye,2,0,"th",11)(21,Ee,2,1,"td",12),u(),c(22,16),m(23,De,2,0,"th",11)(24,Ie,2,1,"td",12),u(),c(25,17),m(26,Pe,2,0,"th",11)(27,Ve,3,4,"td",12),u(),c(28,18),m(29,Re,2,0,"th",11)(30,He,2,1,"td",19),u(),c(31,20),m(32,$e,2,0,"th",21)(33,ke,2,1,"td",12),u(),c(34,22),m(35,Ue,2,0,"th",21)(36,Fe,3,1,"td",12),u(),m(37,Qe,1,0,"tr",23)(38,Ne,1,0,"tr",24),a(),_(39,"mat-paginator",25,1),a()()()}i&2&&(s(),P("pointer-events",r.showSpinner?"none":"auto"),s(),w(r.showSpinner?2:-1),s(35),S("matHeaderRowDef",r.displayedColumns),s(),S("matRowDefColumns",r.displayedColumns),s(),S("length",r.dataSource.data.length)("pageIndex",0)("pageSize",10))},dependencies:[se,b,ee,oe,te,Z,ae,ie,ne,re,le,de,y,ue,E,ce,z,K,J,Y,X,B,pe,G,j,W,L,Q,N,q,_e],styles:[".full-width-table[_ngcontent-%COMP%]{width:100%}.animate__animated[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;height:100%}.users-table[_ngcontent-%COMP%]{padding-top:2vh;width:80vw}.options[_ngcontent-%COMP%]{padding-top:2vh;align-self:flex-start;margin-left:20vw}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%;position:absolute;left:0;background-color:#ffffffb3}.cutom-input[_ngcontent-%COMP%]{width:10vw}body[_ngcontent-%COMP%]{height:90vh}"]})};export{he as TodosTurnos};
