import{a as fe,b as _e}from"./chunk-MRTBN2YX.js";import{a as G,b as J}from"./chunk-HVGWXOVX.js";import{a as E,b as ee,c as te,d as ie,e as ne,f as ae,g as oe,h as re,i as le,j as ce,k as se,l as me,m as D,n as de,o as V,p as ue,q as pe}from"./chunk-MSHBABFG.js";import"./chunk-272TX6CN.js";import"./chunk-ALG4XX3S.js";import{a as Y,b as Z}from"./chunk-O2433Z7Z.js";import{a as L}from"./chunk-YPC5N46O.js";import{a as Q}from"./chunk-B2KEHLRQ.js";import{d as j}from"./chunk-E3NOVVMW.js";import{b as q,e as A,j as N,n as W}from"./chunk-SDPJNVPD.js";import{a as F}from"./chunk-6T6KKZPT.js";import"./chunk-X5YLR3NI.js";import{I as K,J as X}from"./chunk-OQI5TMSC.js";import"./chunk-NYLRLJZA.js";import{h as z}from"./chunk-AULLATG4.js";import{Da as s,Eb as y,Hb as c,Ib as x,Jb as R,Lb as $,Mb as k,Nb as H,Oa as B,Sb as O,Ta as d,Ub as U,X as I,aa as f,ba as _,bb as C,cb as g,hb as S,ib as a,jb as o,kb as T,lb as u,mb as p,ob as w,sb as v,tb as m,xb as M,yb as P,zb as b}from"./chunk-RZXA2LSZ.js";import"./chunk-ODN5LVDJ.js";function Ce(t,i){t&1&&(a(0,"div",3),T(1,"mat-spinner",26),o())}function ge(t,i){t&1&&(a(0,"th",27),c(1,"Fecha"),o())}function Te(t,i){if(t&1&&(a(0,"td",28),c(1),O(2,"date"),o()),t&2){let e=i.$implicit;s(),x(U(2,1,e.fecha,"dd/MM/yyyy HH:mm"))}}function we(t,i){t&1&&(a(0,"th",27),c(1,"Especialidad"),o())}function xe(t,i){if(t&1&&(a(0,"td",28),c(1),o()),t&2){let e=i.$implicit;s(),x(e.especialidad)}}function Se(t,i){t&1&&(a(0,"th",27),c(1,"Estado"),o())}function ve(t,i){if(t&1&&(a(0,"td",29),c(1),o()),t&2){let e=i.$implicit;s(),x(e.estado.toUpperCase())}}function Me(t,i){t&1&&(a(0,"th",30),c(1,"Cancelar"),o())}function Pe(t,i){if(t&1){let e=w();a(0,"button",32),v("click",function(n){f(e);let r=m().$implicit,h=m();return _(h.onActionButtonClick(n,r,"cancelado"))})("focusout",function(){f(e);let n=m(2);return _(n.refresh())}),c(1,"Cancelar"),o()}if(t&2){let e=m().$implicit;y("pointer-events",e.comentario==null||e.comentario==""?"none":"auto")}}function be(t,i){if(t&1&&(a(0,"td",28),C(1,Pe,2,2,"button",31),o()),t&2){let e=i.$implicit;s(),g(e.estado=="pendiente"||e.estado=="aceptado"?1:-1)}}function ye(t,i){t&1&&(a(0,"th",30),c(1,"Calificar"),o())}function Ee(t,i){if(t&1){let e=w();a(0,"button",32),v("click",function(n){f(e);let r=m().$implicit,h=m();return _(h.onCalificarButtonClick(n,r))})("focusout",function(){f(e);let n=m(2);return _(n.refresh())}),c(1,"Calificar"),o()}if(t&2){let e=m().$implicit;y("pointer-events",e.calificacion==null||e.calificacion==""?"none":"auto")}}function De(t,i){if(t&1&&(a(0,"td",28),C(1,Ee,2,2,"button",31),o()),t&2){let e=i.$implicit;s(),g(e.estado=="finalizado"&&e.calificacion==null?1:-1)}}function Ve(t,i){t&1&&(a(0,"th",30),c(1,"Comentario"),o())}function Ie(t,i){if(t&1){let e=w();a(0,"textarea",34),H("ngModelChange",function(n){f(e);let r=m().$implicit;return k(r.comentario,n)||(r.comentario=n),_(n)}),o()}if(t&2){let e=m().$implicit;$("ngModel",e.comentario)}}function Re(t,i){if(t&1&&c(0),t&2){let e=m().$implicit;R(" ",e.comentario," ")}}function $e(t,i){if(t&1&&(a(0,"td",28),C(1,Ie,1,1,"textarea",33)(2,Re,1,1),o()),t&2){let e=i.$implicit;s(),g(e.estado=="pendiente"||e.estado=="aceptado"?1:2)}}function ke(t,i){t&1&&(a(0,"th",30),c(1,"Calificaci\xF3n"),o())}function He(t,i){if(t&1){let e=w();a(0,"textarea",34),H("ngModelChange",function(n){f(e);let r=m().$implicit;return k(r.calificacion,n)||(r.calificacion=n),_(n)}),o()}if(t&2){let e=m().$implicit;$("ngModel",e.calificacion)}}function Be(t,i){if(t&1&&c(0),t&2){let e=m().$implicit;R(" ",e.calificacion," ")}}function Oe(t,i){if(t&1&&(a(0,"td",28),C(1,He,1,1,"textarea",33)(2,Be,1,1),o()),t&2){let e=i.$implicit;s(),g(e.estado=="finalizado"&&e.calificacion==null?1:2)}}function Ue(t,i){t&1&&(a(0,"th",27),c(1,"Nombre"),o())}function ze(t,i){if(t&1&&(a(0,"td",28),c(1),o()),t&2){let e=i.$implicit;s(),x(e.firstname)}}function Fe(t,i){t&1&&(a(0,"th",27),c(1,"Apellido"),o())}function Qe(t,i){if(t&1&&(a(0,"td",28),c(1),o()),t&2){let e=i.$implicit;s(),x(e.surname)}}function qe(t,i){t&1&&T(0,"tr",35)}function Ae(t,i){t&1&&T(0,"tr",36)}var he=class t{paginator;sort;table;supabaseService=I(F);signInService=I(Q);showSpinner=!1;todosUsuarios=[];dataSource;displayedColumns=["fecha","especialidad","firstname","surname","estado","comment","rechazar","calificar","finalizar"];ngOnInit(){this.signInService.getUser().then(()=>{this.signInService.getUsuario().then(()=>{this.getTurnos(this.signInService.usuario.email)})}),this.getUsuarios()}getTurnos(i){this.supabaseService.supabase.from("turnos").select(`
      *,
      users(firstname, surname)
      `).eq("email_paciente",i).then(({data:e,error:l})=>{if(l)console.log(l.message);else{var n=[];for(let r=0;r<e.length;r++){let h=new fe(e[r].fecha,e[r].email_esp,e[r].email_paciente,e[r].especialidad,e[r].estado,e[r].comentario,e[r].users.firstname,e[r].users.surname,e[r].calificacion);n.push(h)}this.dataSource=new me(n),this.refresh()}})}getUsuarios(){this.supabaseService.supabase.from("users").select().then(({data:i,error:e})=>{e?console.log(e.message):(this.todosUsuarios=i,this.refresh())})}onActionButtonClick(i,e,l){this.showSpinner=!0;let n=this.dataSource.data.find(r=>r.fecha==e.fecha);n.estado=l,e.estado=="aceptado"?this.aceptarTurno(n.fecha):this.updateTurno(n.fecha,n.estado,n.comentario),this.table.renderRows()}onCalificarButtonClick(i,e){this.addCalificacion(e.fecha,e.calificacion),this.table.renderRows()}updateTurno(i,e,l){this.supabaseService.supabase.from("turnos").update({estado:e,comentario:l}).eq("fecha",i).then(()=>{this.showSpinner=!1})}addCalificacion(i,e){this.supabaseService.supabase.from("turnos").update({calificacion:e}).eq("fecha",i).then(()=>{this.showSpinner=!1})}aceptarTurno(i){this.supabaseService.supabase.from("turnos").update({estado:"aceptado"}).eq("fecha",i).then(()=>{this.showSpinner=!1})}ngAfterViewInit(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.table.dataSource=this.dataSource}refresh(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.table.dataSource=this.dataSource}applyFilter(i){let e=i.target.value;this.dataSource.filter=e.trim().toLowerCase()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=B({type:t,selectors:[["app-turnos-paciente"]],viewQuery:function(e,l){if(e&1&&(M(D,5),M(V,5),M(E,5)),e&2){let n;P(n=b())&&(l.paginator=n.first),P(n=b())&&(l.sort=n.first),P(n=b())&&(l.table=n.first)}},decls:41,vars:8,consts:[["input",""],["paginator",""],["hover","",1,"container"],[1,"spinner"],[1,"options"],[1,"example-full-width"],["matInput","","placeholder","Buscar",1,"cutom-input",3,"keyup"],[1,"users-table"],[1,"mat-elevation-z2"],["mat-table","","matSort","","aria-label","Users",1,"full-width-table"],["matColumnDef","fecha"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","especialidad"],["matColumnDef","estado"],["mat-cell","","appRemarcar","",4,"matCellDef"],["matColumnDef","rechazar"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","finalizar"],["matColumnDef","comment"],["matColumnDef","calificar"],["matColumnDef","firstname"],["matColumnDef","surname"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page",3,"length","pageIndex","pageSize"],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","","appRemarcar",""],["mat-header-cell",""],["mat-raised-button","",3,"pointer-events"],["mat-raised-button","",3,"click","focusout"],[3,"ngModel"],[3,"ngModelChange","ngModel"],["mat-header-row",""],["mat-row",""]],template:function(e,l){if(e&1){let n=w();T(0,"app-header"),a(1,"div",2),C(2,Ce,2,0,"div",3),a(3,"div",4)(4,"mat-form-field",5)(5,"input",6,0),v("keyup",function(h){return f(n),_(l.applyFilter(h))}),o()()(),a(7,"div",7)(8,"div",8)(9,"table",9),u(10,10),d(11,ge,2,0,"th",11)(12,Te,3,4,"td",12),p(),u(13,13),d(14,we,2,0,"th",11)(15,xe,2,1,"td",12),p(),u(16,14),d(17,Se,2,0,"th",11)(18,ve,2,1,"td",15),p(),u(19,16),d(20,Me,2,0,"th",17)(21,be,2,1,"td",12),p(),u(22,18),d(23,ye,2,0,"th",17)(24,De,2,1,"td",12),p(),u(25,19),d(26,Ve,2,0,"th",17)(27,$e,3,1,"td",12),p(),u(28,20),d(29,ke,2,0,"th",17)(30,Oe,3,1,"td",12),p(),u(31,21),d(32,Ue,2,0,"th",11)(33,ze,2,1,"td",12),p(),u(34,22),d(35,Fe,2,0,"th",11)(36,Qe,2,1,"td",12),p(),d(37,qe,1,0,"tr",23)(38,Ae,1,0,"tr",24),o(),T(39,"mat-paginator",25,1),o()()()}e&2&&(s(),y("pointer-events",l.showSpinner?"none":"auto"),s(),g(l.showSpinner?2:-1),s(35),S("matHeaderRowDef",l.displayedColumns),s(),S("matRowDefColumns",l.displayedColumns),s(),S("length",l.dataSource.data.length)("pageIndex",0)("pageSize",10))},dependencies:[se,E,te,oe,ie,ee,re,ne,ae,le,ce,de,D,pe,V,ue,L,X,K,Z,Y,z,J,G,j,W,q,A,N,_e],styles:[".full-width-table[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;height:100%}.users-table[_ngcontent-%COMP%]{padding-top:2vh;width:80vw}.options[_ngcontent-%COMP%]{padding-top:2vh;align-self:flex-start;margin-left:20vw}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%;position:absolute;left:0;background-color:#ffffffb3}.cutom-input[_ngcontent-%COMP%]{width:10vw}body[_ngcontent-%COMP%]{height:90vh}"]})};export{he as TurnosPaciente};
