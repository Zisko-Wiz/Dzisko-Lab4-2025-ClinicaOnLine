import{a as l}from"./chunk-6T6KKZPT.js";import{S as o,Va as t,W as u}from"./chunk-RZXA2LSZ.js";import{i as r}from"./chunk-ODN5LVDJ.js";var c=class a{constructor(e){this.supaService=e}isLogged=!1;user;usuario;userRole="invitado";especialidades="";emitter=new t;horarioEmitter=new t;avatarURL1="";avatarURL2="";horarios;getUser(){return r(this,null,function*(){return this.supaService.supabase.auth.getUser().then(({data:e})=>{e.user!=null?(this.user=e.user,this.isLogged=!0,this.emitter.emit(e.user)):(this.isLogged=!1,this.emitter.emit(void 0))}).finally(()=>{this.getRole()})})}getRole(){return r(this,null,function*(){if(this.user)return this.supaService.supabase.from("users").select().eq("email",this.user.email).then(({data:e,error:i})=>{i?console.log(i.message):(this.userRole=e[0].role,this.getUsuario())})})}getUsuario(){return r(this,null,function*(){if(this.user)return this.supaService.supabase.from("users").select().eq("email",this.user.email).then(({data:e,error:i})=>{i?console.log(i.message):this.usuario=e[0]})})}getEspecialidades(){return r(this,null,function*(){if(this.usuario?.role=="especialista")return this.supaService.supabase.from("users").select(`
        especialidades (nombre)
        `).eq("email","demekoj370@iridales.com").then(({data:e,error:i})=>{if(i)console.log(i);else{this.especialidades="";for(let s=0;s<e[0].especialidades.length;s++)s==0?this.especialidades+=`${e[0].especialidades[s].nombre}`:this.especialidades+=`, ${e[0].especialidades[s].nombre}`}})})}getAvatarUrl(){if(this.usuario?.email!=null){var e=this.usuario?.email.split("@"),i=`${e[0]}-1`,{data:s}=this.supaService.supabase.storage.from("profile-pictures").getPublicUrl(i);if(this.avatarURL1=s.publicUrl,this.usuario?.role=="paciente"){i=`${e[0]}-2`;var{data:s}=this.supaService.supabase.storage.from("profile-pictures").getPublicUrl(i);this.avatarURL2=s.publicUrl}}}getHorarios(){return r(this,null,function*(){if(this.usuario!=null)return this.supaService.supabase.from("horarios").select().eq("email_esp",this.usuario?.email).then(({data:e,error:i})=>{i?console.log(i.message):this.horarioEmitter.emit(e)})})}getHorariosByEmail(e){return r(this,null,function*(){return this.supaService.supabase.from("horarios").select().eq("email_esp",e).then(({data:i,error:s})=>{s?console.log(s.message):this.horarioEmitter.emit(i)})})}static \u0275fac=function(i){return new(i||a)(u(l))};static \u0275prov=o({token:a,factory:a.\u0275fac,providedIn:"root"})};export{c as a};
