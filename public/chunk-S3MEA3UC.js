import{a as fe}from"./chunk-FEUA5MXF.js";import{a as _e,b as he}from"./chunk-MRTBN2YX.js";import{a as G,b as J}from"./chunk-HVGWXOVX.js";import{a as D,b as ee,c as te,d as ie,e as ne,f as oe,g as ae,h as re,i as se,j as le,k as me,l as ce,m as V,n as de,o as I,p as ue,q as pe}from"./chunk-MSHBABFG.js";import"./chunk-272TX6CN.js";import"./chunk-ALG4XX3S.js";import{a as Y,b as Z}from"./chunk-O2433Z7Z.js";import{a as L}from"./chunk-YPC5N46O.js";import{a as O}from"./chunk-B2KEHLRQ.js";import{d as W}from"./chunk-E3NOVVMW.js";import{b as Q,e as q,j as N,n as j}from"./chunk-SDPJNVPD.js";import{a as F}from"./chunk-6T6KKZPT.js";import"./chunk-X5YLR3NI.js";import{I as K,J as X}from"./chunk-OQI5TMSC.js";import"./chunk-NYLRLJZA.js";import{h as B}from"./chunk-AULLATG4.js";import{Da as c,Eb as E,Hb as l,Ib as x,Jb as z,Lb as H,Mb as U,Nb as A,Oa as $,Sb as R,Ta as d,Ub as k,X as P,aa as p,ba as _,bb as C,cb as M,hb as S,ib as a,jb as r,kb as T,lb as f,mb as h,ob as g,sb as w,tb as m,xb as v,yb as b,zb as y}from"./chunk-RZXA2LSZ.js";import"./chunk-ODN5LVDJ.js";function Me(t,i){t&1&&(a(0,"div",3),T(1,"mat-spinner",25),r())}function Te(t,i){t&1&&(a(0,"th",26),l(1,"Fecha"),r())}function ge(t,i){if(t&1&&(a(0,"td",27),l(1),R(2,"date"),r()),t&2){let e=i.$implicit;c(),x(k(2,1,e.fecha,"dd/MM/yyyy HH:mm"))}}function we(t,i){t&1&&(a(0,"th",26),l(1,"Especialidad"),r())}function xe(t,i){if(t&1&&(a(0,"td",27),l(1),r()),t&2){let e=i.$implicit;c(),x(e.especialidad)}}function Se(t,i){t&1&&(a(0,"th",26),l(1,"Paciente"),r())}function ve(t,i){if(t&1&&(a(0,"td",27),l(1),R(2,"nombre"),r()),t&2){let e=i.$implicit,o=m();c(),x(k(2,1,e.email_paciente,o.todosUsuarios))}}function be(t,i){t&1&&(a(0,"th",26),l(1,"Estado"),r())}function ye(t,i){if(t&1&&(a(0,"td",28),l(1),r()),t&2){let e=i.$implicit;c(),x(e.estado.toUpperCase())}}function Ee(t,i){t&1&&(a(0,"th",29),l(1,"Aceptar"),r())}function De(t,i){if(t&1){let e=g();a(0,"button",31),w("click",function(n){p(e);let s=m().$implicit,u=m();return _(u.onActionButtonClick(n,s,"aceptado"))})("focusout",function(){p(e);let n=m(2);return _(n.refresh())}),l(1,"Aceptar"),r()}}function Ve(t,i){if(t&1&&(a(0,"td",27),C(1,De,2,0,"button",30),r()),t&2){let e=i.$implicit;c(),M(e.estado=="pendiente"?1:-1)}}function Ie(t,i){t&1&&(a(0,"th",29),l(1,"Rechazar"),r())}function Pe(t,i){if(t&1){let e=g();a(0,"button",31),w("click",function(n){p(e);let s=m().$implicit,u=m();return _(u.onActionButtonClick(n,s,"rechazado"))})("focusout",function(){p(e);let n=m(2);return _(n.refresh())}),l(1,"Rechazar"),r()}if(t&2){let e=m().$implicit;E("pointer-events",e.comentario==null||e.comentario==""?"none":"auto")}}function Re(t,i){if(t&1&&(a(0,"td",27),C(1,Pe,2,2,"button",32),r()),t&2){let e=i.$implicit;c(),M(e.estado=="pendiente"||e.estado=="aceptado"?1:-1)}}function ke(t,i){t&1&&(a(0,"th",29),l(1,"Finalizar"),r())}function $e(t,i){if(t&1){let e=g();a(0,"button",31),w("click",function(n){p(e);let s=m().$implicit,u=m();return _(u.onActionButtonClick(n,s,"finalizado"))})("focusout",function(){p(e);let n=m(2);return _(n.refresh())}),l(1,"Finalizar"),r()}if(t&2){let e=m().$implicit;E("pointer-events",e.comentario==null||e.comentario==""?"none":"auto")}}function ze(t,i){if(t&1&&(a(0,"td",27),C(1,$e,2,2,"button",32),r()),t&2){let e=i.$implicit;c(),M(e.estado=="pendiente"||e.estado=="aceptado"?1:-1)}}function He(t,i){t&1&&(a(0,"th",29),l(1,"Comentario/Rese\xF1a"),r())}function Ue(t,i){if(t&1){let e=g();a(0,"textarea",34),A("ngModelChange",function(n){p(e);let s=m().$implicit;return U(s.comentario,n)||(s.comentario=n),_(n)}),r()}if(t&2){let e=m().$implicit;H("ngModel",e.comentario)}}function Ae(t,i){if(t&1&&l(0),t&2){let e=m().$implicit;z(" ",e.comentario," ")}}function Be(t,i){if(t&1&&(a(0,"td",27),C(1,Ue,1,1,"textarea",33)(2,Ae,1,1),r()),t&2){let e=i.$implicit;c(),M(e.estado=="pendiente"||e.estado=="aceptado"?1:2)}}function Fe(t,i){t&1&&T(0,"tr",35)}function Oe(t,i){t&1&&T(0,"tr",36)}var Ce=class t{paginator;sort;table;supabaseService=P(F);signInService=P(O);showSpinner=!1;todosUsuarios=[];dataSource;displayedColumns=["fecha","especialidad","email_paciente","aceptar","rechazar","finalizar","estado","comment"];ngOnInit(){this.signInService.getUser().then(()=>{this.signInService.getUsuario().then(()=>{this.getTurnos(this.signInService.usuario.email)})}),this.getUsuarios()}getTurnos(i){this.supabaseService.supabase.from("turnos").select(`
      *,
      users(firstname, surname)
      `).eq("email_esp",i).then(({data:e,error:o})=>{if(o)console.log(o.message);else{var n=[];for(let s=0;s<e.length;s++){let u=new _e(e[s].fecha,e[s].email_esp,e[s].email_paciente,e[s].especialidad,e[s].estado,e[s].comentario,e[s].users.firstname,e[s].users.surname,e[s].calificacion);n.push(u)}this.dataSource=new ce(n),this.refresh()}})}getUsuarios(){this.supabaseService.supabase.from("users").select().then(({data:i,error:e})=>{e?console.log(e.message):(this.todosUsuarios=i,this.refresh())})}onActionButtonClick(i,e,o){this.showSpinner=!0;let n=this.dataSource.data.find(s=>s.fecha==e.fecha);n.estado=o,e.estado=="aceptado"?this.aceptarTurno(n.fecha):this.updateTurno(n.fecha,n.estado,n.comentario),this.table.renderRows()}updateTurno(i,e,o){this.supabaseService.supabase.from("turnos").update({estado:e,comentario:o}).eq("fecha",i).then(()=>{this.showSpinner=!1})}aceptarTurno(i){this.supabaseService.supabase.from("turnos").update({estado:"aceptado"}).eq("fecha",i).then(()=>{this.showSpinner=!1})}ngAfterViewInit(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.table.dataSource=this.dataSource}refresh(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.table.dataSource=this.dataSource}applyFilter(i){let e=i.target.value;this.dataSource.filter=e.trim().toLowerCase()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=$({type:t,selectors:[["app-mis-turnos"]],viewQuery:function(e,o){if(e&1&&(v(V,5),v(I,5),v(D,5)),e&2){let n;b(n=y())&&(o.paginator=n.first),b(n=y())&&(o.sort=n.first),b(n=y())&&(o.table=n.first)}},decls:38,vars:8,consts:[["input",""],["paginator",""],["hover","",1,"container"],[1,"spinner"],[1,"options"],[1,"example-full-width"],["matInput","","placeholder","Buscar",1,"cutom-input",3,"keyup"],[1,"users-table"],[1,"mat-elevation-z2"],["mat-table","","matSort","","aria-label","Users",1,"full-width-table"],["matColumnDef","fecha"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","especialidad"],["matColumnDef","email_paciente"],["matColumnDef","estado"],["mat-cell","","appRemarcar","",4,"matCellDef"],["matColumnDef","aceptar"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","rechazar"],["matColumnDef","finalizar"],["matColumnDef","comment"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page",3,"length","pageIndex","pageSize"],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","","appRemarcar",""],["mat-header-cell",""],["mat-raised-button",""],["mat-raised-button","",3,"click","focusout"],["mat-raised-button","",3,"pointer-events"],[3,"ngModel"],[3,"ngModelChange","ngModel"],["mat-header-row",""],["mat-row",""]],template:function(e,o){if(e&1){let n=g();T(0,"app-header"),a(1,"div",2),C(2,Me,2,0,"div",3),a(3,"div",4)(4,"mat-form-field",5)(5,"input",6,0),w("keyup",function(u){return p(n),_(o.applyFilter(u))}),r()()(),a(7,"div",7)(8,"div",8)(9,"table",9),f(10,10),d(11,Te,2,0,"th",11)(12,ge,3,4,"td",12),h(),f(13,13),d(14,we,2,0,"th",11)(15,xe,2,1,"td",12),h(),f(16,14),d(17,Se,2,0,"th",11)(18,ve,3,4,"td",12),h(),f(19,15),d(20,be,2,0,"th",11)(21,ye,2,1,"td",16),h(),f(22,17),d(23,Ee,2,0,"th",18)(24,Ve,2,1,"td",12),h(),f(25,19),d(26,Ie,2,0,"th",18)(27,Re,2,1,"td",12),h(),f(28,20),d(29,ke,2,0,"th",18)(30,ze,2,1,"td",12),h(),f(31,21),d(32,He,2,0,"th",18)(33,Be,3,1,"td",12),h(),d(34,Fe,1,0,"tr",22)(35,Oe,1,0,"tr",23),r(),T(36,"mat-paginator",24,1),r()()()}e&2&&(c(),E("pointer-events",o.showSpinner?"none":"auto"),c(),M(o.showSpinner?2:-1),c(32),S("matHeaderRowDef",o.displayedColumns),c(),S("matRowDefColumns",o.displayedColumns),c(),S("length",o.dataSource.data.length)("pageIndex",0)("pageSize",10))},dependencies:[me,D,te,ae,ie,ee,re,ne,oe,se,le,de,V,pe,I,ue,L,X,K,Z,Y,B,fe,J,G,W,j,Q,q,N,he],styles:[".full-width-table[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;height:100%}.users-table[_ngcontent-%COMP%]{padding-top:2vh;width:80vw}.options[_ngcontent-%COMP%]{padding-top:2vh;align-self:flex-start;margin-left:20vw}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%;position:absolute;left:0;background-color:#ffffffb3}.cutom-input[_ngcontent-%COMP%]{width:10vw}body[_ngcontent-%COMP%]{height:90vh}"]})};export{Ce as MisTurnos};
