import{a as I,b as A,c as y}from"./chunk-V5D6QXZY.js";import"./chunk-MS4AQ6UA.js";import{b as J}from"./chunk-MUUKOUL7.js";import{a as M,b as V}from"./chunk-TLV7MEOK.js";import{a as X,v as Z,w as ee}from"./chunk-NVNTWJJS.js";import{a as te,b as ie}from"./chunk-JEX352U2.js";import{a as W}from"./chunk-DGLVMMBZ.js";import{a as z}from"./chunk-UX76GUPX.js";import"./chunk-SENEU3FL.js";import{d as N,j as q,p as G}from"./chunk-7XGRIRYV.js";import{a as Y}from"./chunk-3FX5JOZC.js";import"./chunk-X5YLR3NI.js";import{j as K,k as Q}from"./chunk-K6BGC66R.js";import"./chunk-TMRG5LEW.js";import{f as B}from"./chunk-5M3LTLOJ.js";import"./chunk-SLRTFQNB.js";import{Ba as O,Da as l,Eb as R,Hb as v,Ib as P,Kb as F,Lb as $,Mb as U,Nb as j,Oa as H,Ob as D,X as w,aa as p,ba as m,bb as T,cb as h,db as L,eb as b,fb as x,gb as C,hb as E,ib as r,jb as c,kb as d,ob as u,sb as g,tb as s}from"./chunk-VLVEKFRY.js";import{i as k}from"./chunk-ODN5LVDJ.js";function se(o,t){o&1&&(r(0,"div",1),d(1,"mat-spinner",3),c())}function ae(o,t){if(o&1){let e=u();r(0,"div",4)(1,"h1"),v(2),c(),r(3,"div",5),g("click",function(){let n=p(e).$implicit,a=s(2);return m(a.escogerPaciente(n.email))}),d(4,"img",6),c()()}if(o&2){let e=t.$implicit,i=s(2);l(2),F("",e.firstname," ",e.surname),l(2),E("src",D(i.getAvatarUrl(e.email)),O)}}function re(o,t){if(o&1&&x(0,ae,5,4,"div",4,b),o&2){let e=s();C(e.pacientes)}}function ce(o,t){if(o&1){let e=u();r(0,"div",14),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",15),c()}}function le(o,t){if(o&1){let e=u();r(0,"div",16),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",17),c()}}function pe(o,t){if(o&1){let e=u();r(0,"div",18),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",19),c()}}function me(o,t){if(o&1){let e=u();r(0,"div",20),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",21),c()}}function de(o,t){if(o&1){let e=u();r(0,"div",22),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",23),c()}}function _e(o,t){if(o&1){let e=u();r(0,"div",24),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",25),c()}}function ue(o,t){if(o&1){let e=u();r(0,"div",26),g("click",function(){p(e);let n=s().$implicit,a=s(2);return m(a.escogerEspecialidad(n.nombre))}),d(1,"img",27),c()}if(o&2){let e=s().$implicit;E("matTooltip",D(e.nombre))}}function ge(o,t){if(o&1&&T(0,ce,2,0,"div",7)(1,le,2,0,"div",8)(2,pe,2,0,"div",9)(3,me,2,0,"div",10)(4,de,2,0,"div",11)(5,_e,2,0,"div",12)(6,ue,2,2,"div",13),o&2){let e,i=t.$implicit;h((e=i.nombre)==="cardiolog\xEDa"?0:e==="oftalmolog\xEDa"?1:e==="otorrinolaringolog\xEDa"?2:e==="neurolog\xEDa"?3:e==="traumatolog\xEDa"?4:e==="gastroenterolog\xEDa"?5:6)}}function fe(o,t){if(o&1&&x(0,ge,7,1,null,null,b),o&2){let e=s();C(e.especialidades)}}function Te(o,t){if(o&1){let e=u();r(0,"div",4)(1,"h1"),v(2),c(),r(3,"div",5),g("click",function(){let n=p(e).$implicit,a=s(3);return m(a.escogerEspecialista(n.email))}),d(4,"img",6),c()()}if(o&2){let e=t.$implicit,i=s(3);l(2),F("",e.firstname," ",e.surname),l(2),E("src",D(i.getAvatarUrl(e.email)),O)}}function he(o,t){if(o&1&&x(0,Te,5,4,"div",4,b),o&2){let e=s(2);C(e.especialistas==null?null:e.especialistas.users)}}function xe(o,t){if(o&1&&T(0,he,2,0),o&2){let e=s();h(e.especialistasCargados?0:-1)}}function Ce(o,t){if(o&1&&(r(0,"mat-option",31),v(1),c()),o&2){let e=s().$implicit;E("value",e.start.toISO()),l(),P(e.start.toFormat("HH:mm"))}}function ve(o,t){if(o&1&&T(0,Ce,2,2,"mat-option",31),o&2){let e=t.$implicit,i=s(3);h(i.isHorarioDisponible(e)?0:-1)}}function be(o,t){if(o&1){let e=u();r(0,"div",4)(1,"div",28)(2,"h1"),v(3),c(),r(4,"mat-select",29),j("valueChange",function(n){p(e);let a=s(2);return U(a.fechaSeleccionada,n)||(a.fechaSeleccionada=n),m(n)}),x(5,ve,1,1,null,null,b),c(),r(7,"button",30),g("click",function(){p(e);let n=s(2);return m(n.insertTurno())}),v(8,"Tomar turno"),c()()()}if(o&2){let e=t.$index,i=s(2);l(3),P(i.horariosDelEspecialista[e][0].start.toFormat("dd/MM")),l(),$("value",i.fechaSeleccionada),l(),C(i.horariosDelEspecialista[e]),l(2),R("pointer-events",i.fechaSeleccionada==""?"none":"auto")}}function Ee(o,t){if(o&1&&x(0,be,9,4,"div",4,L),o&2){let e=s();C(e.horariosDelEspecialista)}}var oe=class o{supabaseService=w(Y);signInService=w(z);router=w(B);horariosSubscription;especialidades=[];especialidadEscogida="";especialistaEscogido="";especialistas;especialistasCargados=!1;turnosCargados=!1;horariosCargados=!1;horarios;proximosDias;turnosSacados=[];horariosDelEspecialista=[];loading=!0;paciente=new q("",[N.required]);fechaSeleccionada="";isAdmin=!1;pacientes;pacienteEscogido="";ngOnInit(){this.signInService.getUser().then(()=>{this.signInService.getUsuario().then(()=>{this.signInService.getRole()}).then(()=>{this.signInService.userRole=="administrador"?this.getPacientes():this.pacienteEscogido=this.signInService.usuario?.email})}),this.horariosSubscription=this.signInService.horarioEmitter.subscribe({next:t=>{t!=null&&(this.horarios=t)}}),this.getEspecialidades(),this.setProximosDias()}ngOnDestroy(){this.horariosSubscription?.unsubscribe()}ngAfterViewInit(){this.loading=!1}ngAfterContentInit(){this.loading=!1}setProximosDias(){let t=y.now().startOf("day").plus({hours:8}),e=t.plus({days:16}),i=A.fromDateTimes(t,e),n=I.fromObject({days:1}),a=i.splitBy(n);var S=[];for(let _=0;_<a.length;_++)S.push(a[_].splitAt(a[_].end.minus({hour:13,minute:30}))[0]);this.proximosDias=S,this.loading=!1}getTurnosSacados(t){this.supabaseService.supabase.from("turnos").select().eq("email_esp",t).then(({data:e,error:i})=>{i?console.log(i.message):(this.turnosSacados=e,this.setHorariosDisponibles())})}getEspecialidades(){this.supabaseService.supabase.from("especialidades").select("*").then(({data:t,error:e})=>{e?(console.log(e.message),console.log(e.code)):this.especialidades=t})}getPacientes(){return k(this,null,function*(){return this.supabaseService.supabase.from("users").select().eq("role","paciente").then(({data:t,error:e})=>{e?console.log(e.message):(this.pacientes=t,this.isAdmin=!0)})})}getEspecialistas(){this.supabaseService.supabase.from("especialidades").select(`
      users (firstname, surname, email)
      `).eq("nombre",this.especialidadEscogida).then(({data:t,error:e})=>{e?console.log(e.message):(this.especialistas=t[0],this.especialistasCargados=!0,this.loading=!1)})}getAvatarUrl(t){let e=t.split("@");var{data:i}=this.supabaseService.supabase.storage.from("profile-pictures").getPublicUrl(`${e[0]}-1`);return i.publicUrl}getTurnos(t){return k(this,null,function*(){return this.signInService.getHorariosByEmail(t).then(()=>{this.horariosCargados=!0})})}escogerPaciente(t){this.pacienteEscogido=t,this.isAdmin=!1}escogerEspecialidad(t){this.loading=!0,this.especialidadEscogida=t,this.getEspecialistas()}escogerEspecialista(t){this.loading=!0,this.especialistaEscogido=t,this.getTurnos(t).then(()=>{this.getTurnosSacados(t)})}isHorarioDisponible(t){var e=t.start.toISO(),i=t.start.weekday,n=y.fromFormat(t.start.toFormat("HH:mm"),"HH:mm");if(this.turnosSacados?.length==0)return!0;for(let f=0;f<this.horarios.length;f++){var a=y.fromFormat(this.horarios[f].hora_inicial,"HH:mm"),S=y.fromFormat(this.horarios[f].hora_final,"HH:mm"),_=A.fromDateTimes(a,S);switch(this.horarios[f].dia){case"lunes":if(i==1&&!_.contains(n))return!1;break;case"martes":if(i==2&&!_.contains(n))return!1;break;case"mi\xE9rcoles":if(i==3&&!_.contains(n))return!1;break;case"jueves":if(i==4&&!_.contains(n))return!1;break;case"viernes":if(i==5&&!_.contains(n))return!1;break;case"s\xE1bado":if(i==6&&!_.contains(n))return!1;break}}for(let f=0;f<this.turnosSacados.length;f++)if(e==`${this.turnosSacados[f].fecha}.000+00:00`)return!1;return!0}setHorariosDisponibles(){var t=[],e=I.fromObject({minutes:30});for(let i=0;i<this.proximosDias.length;i++)for(let n=0;n<this.horarios.length;n++)switch(this.horarios[n].dia){case"lunes":this.proximosDias[i].start.weekday==1&&t.push(this.proximosDias[i]);break;case"martes":this.proximosDias[i].start.weekday==2&&t.push(this.proximosDias[i]);break;case"mi\xE9rcoles":this.proximosDias[i].start.weekday==3&&t.push(this.proximosDias[i]);break;case"jueves":this.proximosDias[i].start.weekday==4&&t.push(this.proximosDias[i]);break;case"viernes":this.proximosDias[i].start.weekday==5&&t.push(this.proximosDias[i]);break;case"s\xE1bado":this.proximosDias[i].start.weekday==6&&t.push(this.proximosDias[i]);break}for(let i=0;i<t.length;i++)this.horariosDelEspecialista.push(t[i].splitBy(e));this.loading=!1}insertTurno(){this.loading=!0,this.supabaseService.insertTurno(this.fechaSeleccionada,this.especialistaEscogido,this.pacienteEscogido,this.especialidadEscogida).then(({data:t,error:e})=>{e?console.log(e.message):this.router.navigate(["home"])})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=H({type:o,selectors:[["app-turnos"]],decls:8,vars:3,consts:[[1,"container"],[1,"spinner"],[1,"menu"],["mode","indeterminate"],[1,"esp-menu"],[1,"icon-btn",3,"click"],[1,"icon",3,"src"],["matTooltip","cardiolog\xEDa","matTooltipPosition","above",1,"icon-btn"],["matTooltip","oftalmolog\xEDa","matTooltipPosition","above",1,"icon-btn"],["matTooltip","otorrinolaringolog\xEDa","matTooltipPosition","above",1,"icon-btn"],["matTooltip","neurolog\xEDa","matTooltipPosition","above",1,"icon-btn"],["matTooltip","traumatolog\xEDa","matTooltipPosition","above",1,"icon-btn"],["matTooltip","gastroenterolog\xEDa","matTooltipPosition","above",1,"icon-btn"],["matTooltipPosition","above",1,"icon-btn",3,"matTooltip"],["matTooltip","cardiolog\xEDa","matTooltipPosition","above",1,"icon-btn",3,"click"],["src","heart-beats.png",1,"icon"],["matTooltip","oftalmolog\xEDa","matTooltipPosition","above",1,"icon-btn",3,"click"],["src","eye.png",1,"icon"],["matTooltip","otorrinolaringolog\xEDa","matTooltipPosition","above",1,"icon-btn",3,"click"],["src","ear.png",1,"icon"],["matTooltip","neurolog\xEDa","matTooltipPosition","above",1,"icon-btn",3,"click"],["src","brain.png",1,"icon"],["matTooltip","traumatolog\xEDa","matTooltipPosition","above",1,"icon-btn",3,"click"],["src","wound.png",1,"icon"],["matTooltip","gastroenterolog\xEDa","matTooltipPosition","above",1,"icon-btn",3,"click"],["src","stomach.png",1,"icon"],["matTooltipPosition","above",1,"icon-btn",3,"click","matTooltip"],["src","caduceus.png",1,"icon"],[1,"turno-btn"],["placeholder","00:00",1,"custom-select",3,"valueChange","value"],["type","button","mat-flat-button","",3,"click"],[3,"value"]],template:function(e,i){e&1&&(d(0,"app-header"),r(1,"div",0),T(2,se,2,0,"div",1),r(3,"div",2),T(4,re,2,0),T(5,fe,2,0)(6,xe,1,1)(7,Ee,2,0),c()()),e&2&&(l(2),h(i.loading?2:-1),l(2),h(i.isAdmin?4:-1),l(),h(i.pacienteEscogido!=""&&i.especialidadEscogida==""&&i.especialistaEscogido==""?5:i.especialistaEscogido==""?6:7))},dependencies:[W,V,M,ee,Z,X,ie,te,Q,K,G,J],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;padding-top:10vh}.menu[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:2vw;justify-content:center;justify-items:center}.icon[_ngcontent-%COMP%]{width:10vw;aspect-ratio:auto}.icon-btn[_ngcontent-%COMP%], .turno-btn[_ngcontent-%COMP%]{width:16vw;background-color:#70c2ee;border:1px solid black}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.turno-btn[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-evenly;align-content:space-evenly;padding-left:1vw;padding-right:1vw}.esp-menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.custom-select[_ngcontent-%COMP%]{font-size:2em;margin:.67em 0;font-weight:700}"]})};export{oe as Turnos};
