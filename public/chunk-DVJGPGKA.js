import{a as K}from"./chunk-D3R3HLRR.js";import{a as B,b as L,c as k,e as R,f as N,g as j}from"./chunk-SYUK4LPW.js";import{a as G}from"./chunk-MNR4FOPA.js";import{a as J}from"./chunk-5M4QBNDW.js";import{a as z,b as q}from"./chunk-JEX352U2.js";import{a as A}from"./chunk-DGLVMMBZ.js";import{a as $}from"./chunk-UX76GUPX.js";import"./chunk-7XGRIRYV.js";import{a as H}from"./chunk-3FX5JOZC.js";import"./chunk-X5YLR3NI.js";import{C as S,f as P}from"./chunk-TMRG5LEW.js";import"./chunk-5M3LTLOJ.js";import{a as V}from"./chunk-TCCEH6KL.js";import{h as F}from"./chunk-SLRTFQNB.js";import{Da as d,Fb as E,Hb as l,Ib as f,Oa as h,Pa as b,Sb as C,T as x,Ub as D,X as g,ab as w,bb as I,cb as U,db as M,fb as y,gb as _,hb as T,ib as o,jb as s,kb as v,tb as O}from"./chunk-VLVEKFRY.js";import{i as p}from"./chunk-ODN5LVDJ.js";var Q=(()=>{class t{get vertical(){return this._vertical}set vertical(e){this._vertical=P(e)}_vertical=!1;get inset(){return this._inset}set inset(e){this._inset=P(e)}_inset=!1;static \u0275fac=function(a){return new(a||t)};static \u0275cmp=h({type:t,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(a,r){a&2&&(w("aria-orientation",r.vertical?"vertical":"horizontal"),E("mat-divider-vertical",r.vertical)("mat-divider-horizontal",!r.vertical)("mat-divider-inset",r.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(a,r){},styles:[`.mat-divider{display:block;margin:0;border-top-style:solid;border-top-color:var(--mat-divider-color, var(--mat-sys-outline));border-top-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-vertical{border-top:0;border-right-style:solid;border-right-color:var(--mat-divider-color, var(--mat-sys-outline));border-right-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}
`],encapsulation:2,changeDetection:0})}return t})(),W=(()=>{class t{static \u0275fac=function(a){return new(a||t)};static \u0275mod=b({type:t});static \u0275inj=x({imports:[S,S]})}return t})();function te(t,i){t&1&&(o(0,"div",0),v(1,"mat-spinner",3),s())}function ie(t,i){if(t&1&&(o(0,"div",6)(1,"h3"),l(2),C(3,"date"),s(),o(4,"h4"),l(5,"Rese\xF1a"),s(),o(6,"p"),l(7),s(),o(8,"h4"),l(9,"Historia"),s(),o(10,"p"),l(11),s(),v(12,"mat-divider"),s()),t&2){let e=i.$implicit;d(2),f(D(3,3,e.fecha,"dd/MM/yyyy HH:mm")),d(5),f(e.comentario),d(4),f(e.historia)}}function ae(t,i){if(t&1&&(o(0,"div")(1,"mat-card",4)(2,"mat-card-header"),v(3,"div",5),o(4,"mat-card-title"),l(5),C(6,"nombre"),s()(),o(7,"mat-card-content")(8,"h2"),l(9,"Turnos"),s(),y(10,ie,13,6,"div",6,M),s()()()),t&2){let e=i.$implicit,a=O();d(3),T("appAvatarURL",a.getAvatarURL(e[0].email_paciente)),d(2),f(D(6,2,e[0].email_paciente,a.todosUsuarios)),d(5),_(e)}}var X=class t{supaService=g(H);signInService=g($);historiasClinicas=[];datosDinamicos=[];pacientes=[];todosUsuarios=[];listaFinal=[];loading=!0;ngOnInit(){this.restart()}getUsuarios(){return p(this,null,function*(){return this.supaService.supabase.from("users").select().eq("role","paciente").then(({data:i,error:e})=>{e?console.error(e.message,e.code):this.todosUsuarios=i})})}crearListaFinal(){for(let a=0;a<this.todosUsuarios.length;a++){var i=0,e=[];for(let r=0;r<this.pacientes.length;r++)if(this.pacientes[r].email_paciente==this.todosUsuarios[a].email&&(i+=1,e.push(this.pacientes[r])),i==3){i=0;break}e.length>0&&this.listaFinal.push(e)}this.loading=!1}restart(){this.signInService.getUser().then(()=>{this.signInService.getUsuario().then(()=>{this.getHistoriasClinicas().then(()=>{this.getDatosDinamicos().then(()=>{this.getTurnos(this.signInService.usuario.email).then(()=>{this.getUsuarios().then(()=>{this.crearListaFinal()})})})})})})}getHistoriasClinicas(){return p(this,null,function*(){return this.supaService.supabase.from("historia").select().order("fecha",{ascending:!1}).then(({data:i,error:e})=>{e?console.error(e.message,e.code):this.historiasClinicas=i})})}getDatosDinamicos(){return p(this,null,function*(){return this.supaService.supabase.from("datos_dinamicos").select().order("fecha",{ascending:!1}).then(({data:i,error:e})=>{e?console.error(e.message,e.code):this.datosDinamicos=i})})}getTurnos(i){return p(this,null,function*(){return this.supaService.supabase.from("turnos").select(`
      *,
      users(firstname, surname)
      `).eq("email_esp",i).eq("estado","finalizado").order("fecha",{ascending:!0}).then(({data:e,error:a})=>{if(a)console.error(a.message,a.code);else{var r=[];for(let n=0;n<e.length;n++){let m=this.historiasClinicas.find(c=>c.fecha==e[n].fecha);var u=null;if(m!=null&&(u=`Altura: ${m.altura}
Peso: ${m.peso}
Temperatura: ${m.temperatura}
Presi\xF3n: ${m.presion}`,this.datosDinamicos.find(c=>c.fecha==e[n].fecha)!=null))for(let c=0;c<this.datosDinamicos.length;c++)this.datosDinamicos[c].fecha==e[n].fecha&&(u+=`
${this.datosDinamicos[c].clave}: ${this.datosDinamicos[c].valor}`);let Y=new K(e[n].fecha,e[n].email_esp,e[n].email_paciente,e[n].especialidad,e[n].estado,e[n].comentario,e[n].users.firstname,e[n].users.surname,e[n].calificacion,u);r.push(Y)}this.pacientes=r}})})}getAvatarURL(i){return`${i.split("@")[0]}-1`}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-pacientes"]],decls:6,vars:1,consts:[[1,"spinner"],[1,"container"],[1,"pacientes"],["mode","indeterminate"],[1,"card"],["mat-card-avatar","",1,"avatar",3,"appAvatarURL"],["appMostrarHistorial","",1,"detalles"]],template:function(e,a){e&1&&(v(0,"app-header"),I(1,te,2,0,"div",0),o(2,"div",1)(3,"div",2),y(4,ae,12,5,"div",null,M),s()()),e&2&&(d(),U(a.loading?1:-1),d(3),_(a.listaFinal))},dependencies:[A,j,B,N,k,R,L,W,Q,J,G,q,z,V,F],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;overflow-y:auto}.pacientes[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);width:80vw;padding-top:10vh;overflow-y:auto;height:110%}.card[_ngcontent-%COMP%]{width:20vw}.avatar[_ngcontent-%COMP%]{background-size:cover}p[_ngcontent-%COMP%]{white-space:pre}.historia[_ngcontent-%COMP%]{height:4rem}.spinner[_ngcontent-%COMP%]{background-color:#fff}.detalles[_ngcontent-%COMP%]{height:3rem;overflow:hidden}h3[_ngcontent-%COMP%]{cursor:pointer}body[_ngcontent-%COMP%]{overflow:auto}"]})};export{X as Pacientes};
